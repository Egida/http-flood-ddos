groups:
- name: ddos_alert_group
  rules:

  # Traffic tÄƒng Ä‘á»™t biáº¿n (Nginx)
  - alert: PossibleDDoS
    expr: rate(nginx_http_requests_total[30s]) > 200
    for: 10s
    labels:
      severity: warning
    annotations:
      description: "ğŸš¨ Traffic Nginx tÄƒng máº¡nh â†’ nghi ngá» HTTP Flood"

  # CPU Backend cao
  - alert: HighCPUBackend
    expr: rate(container_cpu_usage_seconds_total{name="be"}[30s]) * 100 > 70
    for: 10s
    labels:
      severity: critical
    annotations:
      description: "ğŸ”¥ CPU Backend vÆ°á»£t 70% â†’ há»‡ thá»‘ng cÃ³ thá»ƒ Ä‘ang bá»‹ táº¥n cÃ´ng"

  # CPU Nginx cao
  - alert: HighCPUNginx
    expr: rate(container_cpu_usage_seconds_total{name="nginx_proxy"}[30s]) * 100 > 70
    for: 10s
    labels:
      severity: warning
    annotations:
      description: "âš ï¸ CPU Nginx Proxy cao â†’ kháº£ nÄƒng cÃ³ traffic báº¥t thÆ°á»ng"

  # XÃ¡c nháº­n DDoS (2 Ä‘iá»u kiá»‡n)
  - alert: ConfirmedDDoS
    expr: (rate(nginx_http_requests_total[30s]) > 200)
          and (rate(container_cpu_usage_seconds_total{name="be"}[30s]) * 100 > 70)
    for: 10s
    labels:
      severity: critical
    annotations:
      description: "ğŸ”¥ XÃC NHáº¬N DDoS: Traffic nginx cao + CPU backend cao"
