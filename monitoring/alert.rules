groups:
- name: ddos_alert_group
  rules:

  # =======================================
  # 1) Traffic ƒë·ªôt bi·∫øn (HTTP Flood nghi ng·ªù)
  # =======================================
  - alert: PossibleDDoS
    expr: rate(nginx_http_requests_total[30s]) > 300
    for: 10s
    labels:
      severity: critical
    annotations:
      description: "üö® Traffic tƒÉng ƒë·ªôt bi·∫øn ‚Üí nghi ng·ªù DDoS HTTP Flood"

  # =======================================
  # 2) CPU cao c·ªßa container Backend (thay v√¨ CPU host)
  # =======================================
  - alert: HighCPUServer
    expr: rate(container_cpu_usage_seconds_total{container="be"}[30s]) > 0.7
    for: 20s
    labels:
      severity: warning
    annotations:
      description: "üî• CPU Backend > 70% trong 20s ‚Üí c√≥ th·ªÉ b·ªã t·∫•n c√¥ng"

  # =======================================
  # 3) X√°c nh·∫≠n DDoS (Traffic + CPU)
  # =======================================
  - alert: ConfirmedDDoS
    expr: (rate(nginx_http_requests_total[30s]) > 300)
          and (rate(container_cpu_usage_seconds_total{container="be"}[30s]) > 0.7)
    for: 10s
    labels:
      severity: critical
    annotations:
      description: "üî• X√ÅC NH·∫¨N DDoS HTTP Flood: Traffic spike + CPU Backend cao"
