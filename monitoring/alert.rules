groups:
- name: ddos_alert_group
  rules:

  # Traffic ƒë·ªôt bi·∫øn
  - alert: PossibleDDoS
    expr: rate(nginx_http_requests_total[30s]) > 300
    for: 10s
    labels:
      severity: critical
    annotations:
      description: "üö® Traffic tƒÉng ƒë·ªôt bi·∫øn ‚Üí nghi ng·ªù DDoS HTTP Flood"

  # CPU server cao
  - alert: HighCPUServer
    expr: 1 - avg(rate(node_cpu_seconds_total{mode="idle"}[1m])) by (instance) > 0.8
    for: 20s
    labels:
      severity: warning
    annotations:
      description: "üî• CPU server v∆∞·ª£t 80% ‚Üí kh·∫£ nƒÉng b·ªã t·∫•n c√¥ng"

  # X√°c nh·∫≠n DDoS
  - alert: ConfirmedDDoS
    expr: (rate(nginx_http_requests_total[30s]) > 300)
          and (1 - avg(rate(node_cpu_seconds_total{mode="idle"}[1m])) by (instance) > 0.8)
    for: 10s
    labels:
      severity: critical
    annotations:
      description: "üî• X√ÅC NH·∫¨N DDoS HTTP Flood: traffic spike + CPU cao"
